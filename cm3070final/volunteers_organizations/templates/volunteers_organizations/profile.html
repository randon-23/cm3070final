{% extends 'base/base_authenticated.html' %}
{% load static %}
{% block title %}Dashboard{% endblock %}
{% block auth_content %}
    <script src="{% static 'js_frontend-scripts/profile-processes.js' %}"></script>

    <!-- Profile Card -->
    <div class="bg-white p-6 rounded-lg shadow-lg flex items-center space-x-6">
        <div class="grid grid-cols-5 gap-6 items-center w-full place-items-center relative">
            <!-- Profile Image -->
            <div class="flex justify-center relative">
                {% if is_own_profile %}
                    {% if user.volunteer %}
                        {% if user.volunteer.profile_img %}
                            <img class="w-64 h-64 rounded-full object-cover" src="{{ user.volunteer.profile_img.url }}" alt="Profile Picture">
                        {% else %}
                            <img class="w-64 h-64 rounded-full object-cover bg-white" src="{% static 'images/default_volunteer.svg' %}" alt="Profile Picture">
                        {% endif %}
                    {% elif user.organization %}
                        {% if user.organization.organization_profile_img %}
                            <img class="w-64 h-64 rounded-full object-cover" src="{{ user.organization.organization_profile_img.url }}" alt="Profile Picture">
                        {% else %}
                            <img class="w-64 h-64 rounded-full object-contain bg-white p-2" src="{% static 'images/default_organization.svg' %}" alt="Profile Picture">
                        {% endif %}
                    {% endif %}
                {% else %}
                    {% if user_profile.volunteer %}
                        {% if user_profile.volunteer.profile_img %}
                            <img class="w-64 h-64 rounded-full object-cover" src="{{ user_profile.volunteer.profile_img }}" alt="Profile Picture">
                        {% else %}
                            <img class="w-64 h-64 rounded-full object-cover bg-white" src="{% static 'images/default_volunteer.svg' %}" alt="Profile Picture">
                        {% endif %}
                    {% elif user_profile.organization %}
                        {% if user_profile.organization.organization_profile_img %}
                            <img class="w-64 h-64 rounded-full object-cover" src="{{ user_profile.organization.organization_profile_img }}" alt="Profile Picture">
                        {% else %}
                            <img class="w-64 h-64 rounded-full object-contain bg-white p-2" src="{% static 'images/default_organization.svg' %}" alt="Profile Picture">
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>

            <!--Name Section-->
            <div class="flex flex-col justify-center text-center relative">
                {% if is_own_profile %}
                    {% if user.volunteer %}
                        <h1 class="text-4xl font-bold">{{ user.volunteer.first_name }}</h1>
                        <h1 class="text-4xl font-bold">{{ user.volunteer.last_name }}</h1>
                    {% elif user.organization %}
                        <h1 class="text-4xl font-bold">{{ user.organization.organization_name }}</h1>
                    {% endif %}
                {% else %}
                    {% if user_profile.volunteer %}
                        <h1 class="text-4xl font-bold">{{ user_profile.volunteer.first_name }}</h1>
                        <h1 class="text-4xl font-bold">{{ user_profile.volunteer.last_name }}</h1>
                    {% elif user_profile.organization %}
                        <h1 class="text-4xl font-bold">{{ user_profile.organization.organization_name }}</h1>
                    {% endif %}
                {% endif %}
            </div>

            <!-- Profile Details -->
            <!--Column 1-->
            <div class="flex flex-col justify-center text-center space-y-2 relative">
                {% if is_own_profile %}
                    {% if user.volunteer %}
                        <p class="text-gray-700">User Type: <strong>{{ user.user_type }}</strong></p>
                        <p class="text-gray-700">Email: <strong>{{ user.email_address }}</strong></p>
                        <p class="text-gray-700">Contact Number: <strong>{{ user.contact_number }}</strong></p>
                    {% elif user.organization %}
                        <p class="text-gray-700">User Type: <strong>{{ user.user_type }}</strong></p>
                        <p class="text-gray-700">Email: <strong>{{ user.email_address }}</strong></p>
                        <p class="text-gray-700">Contact Number: <strong>{{ user.contact_number }}</strong></p>
                        <p class="text-gray-700">
                            Main Location: 
                            <strong>
                                {% if user.organization.organizationpreferences.location.formatted_address %}
                                    {{ user.organization.organizationpreferences.location.formatted_address }}
                                {% else %}
                                    Not Specified Yet
                                {% endif %}
                            </strong>
                        </p>
                    {% endif %}
                {% else %}
                    {% if user_profile.volunteer %}
                        <p class="text-gray-700">User Type: <strong>{{ user_profile.account.user_type }}</strong></p>
                        <p class="text-gray-700">Email: <strong>{{ user_profile.account.email_address }}</strong></p>
                        <p class="text-gray-700">Contact Number: <strong>{{ user_profile.account.contact_number }}</strong></p>
                    {% elif user_profile.organization %}
                        <p class="text-gray-700">User Type: <strong>{{ user_profile.account.user_type }}</strong></p>
                        <p class="text-gray-700">Email: <strong>{{ user_profile.account.email_address }}</strong></p>
                        <p class="text-gray-700">Contact Number: <strong>{{ user_profile.account.contact_number }}</strong></p>
                        <p class="text-gray-700">
                            Main Location: 
                            <strong>
                                {% if user_profile.preferences.location.formatted_address %}
                                    {{ user_profile.preferences.location.formatted_address }}
                                {% else %}
                                    Not Specified Yet
                                {% endif %}
                            </strong>
                        </p>
                    {% endif %}
                {% endif %}
            </div>

            <!--Column 2-->
            <div class="flex flex-col justify-center text-center space-y-2 relative">
                {% if is_own_profile %}
                    {% if user.volunteer %}
                        <p class="text-gray-700">
                            Location: 
                            <strong>
                                {% if user.volunteer.volunteermatchingpreferences.location.formatted_address %}
                                    {{ user.volunteer.volunteermatchingpreferences.location.formatted_address }}
                                {% else %}
                                    Not Specified Yet
                                {% endif %}
                            </strong>
                        </p>
                        <p class="text-gray-700">Bio: <strong>{{ user.volunteer.bio }}</strong></p>
                        <p class="text-gray-700">Date of Birth: <strong>{{ user.volunteer.dob }}</strong></p>
                        <p class="text-gray-700">Followers: <strong id="followers-count">{{ followers_count.followers }}</strong></p>
                    {% elif user.organization %}
                        <p class="text-gray-700">Organization Description: <strong>{{ user.organization.organization_description }}</strong></p>
                        <p class="text-gray-700">Organization Address: <strong>{{ user.organization.organization_address.raw }}</strong></p>
                        <p class="text-gray-700">Organization Website: <a href="{{ user.organization.organization_website }}" target="_blank" class="text-blue-600 underline hover:text-blue-800"><strong>{{ user.organization.organization_website }}</strong></a></p>
                        <p class="text-gray-700">Followers: <strong id="followers-count">{{ followers_count.followers }}</strong></p>
                    {% endif %}
                {% else %}
                    {% if user_profile.volunteer %}
                        <p class="text-gray-700">
                            Location: 
                            <strong>
                                {% if user_profile.preferences.location.formatted_address %}
                                    {{ user_profile.preferences.location.formatted_address }}
                                {% else %}
                                    Not Specified Yet
                                {% endif %}
                            </strong>
                        </p>
                        <p class="text-gray-700">Bio: <strong>{{ user_profile.volunteer.bio }}</strong></p>
                        <p class="text-gray-700">Date of Birth: <strong>{{ user_profile.volunteer.dob }}</strong></p>
                        <p class="text-gray-700">Followers: <strong id="followers-count">{{ followers_count.followers }}</strong></p>
                    {% elif user_profile.organization %}
                        <p class="text-gray-700">Organization Description: <strong>{{ user_profile.organization.organization_description }}</strong></p>
                        <p class="text-gray-700">Organization Address: <strong>{{ user_profile.organization.organization_address.raw }}</strong></p>
                        <p class="text-gray-700">Organization Website: <a href="{{ user_profile.organization.organization_website }}" target="_blank" class="text-blue-600 underline hover:text-blue-800"><strong>{{ user_profile.organization.organization_website }}</strong></a></p>
                        <p class="text-gray-700">Followers: <strong id="followers-count">{{ followers_count.followers }}</strong></p>
                    {% endif %}
                {% endif %}
            </div>

            <!-- Edit Profile Button (Only for Own Profile) / Follow Button-->
            <div id="follow-btn-container" class="w-full flex justify-center items-center relative">
                    {% if is_own_profile %}
                        <a href="{% url 'volunteers_organizations:update_profile' %}" 
                            class="w-full px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />
                            </svg>                          
                            <span class="font-bold">Edit Profile</span>
                        </a>    
                    {% else %}
                    {% if is_following.is_following %}
                        <button id="unfollow-btn" 
                        hx-delete="{% url 'volunteers_organizations:delete_following' user_profile.account.account_uuid %}"
                        hx-trigger="click"
                        hx-target="#follow-btn-container"
                        class="w-full mx-4 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M22 10.5h-6m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM4 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 10.374 21c-2.331 0-4.512-.645-6.374-1.766Z" />
                            </svg>
                            <span class="font-bold">Unfollow</span>
                        </button>
                    {% else %}
                        <button id="follow-btn"
                        hx-post="{% url 'volunteers_organizations:create_following' user_profile.account.account_uuid %}"
                        hx-trigger="click"
                        hx-target="#follow-btn-container"
                        class="w-full mx-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z" />
                            </svg>                      
                            <span class="font-bold">Follow</span>
                        </button>
                    {% endif %}
                {% endif %}
            </div>
                
            <!-- Separators (Tailwind using `after:` pseudo-elements) -->
            <div class="absolute top-1/2 left-[20%] w-[1px] bg-gray-300 h-[75%] transform -translate-y-1/2"></div>
            <div class="absolute top-1/2 left-[40%] w-[1px] bg-gray-300 h-[75%] transform -translate-y-1/2"></div>
            <div class="absolute top-1/2 left-[60%] w-[1px] bg-gray-300 h-[75%] transform -translate-y-1/2"></div>
            <div class="absolute top-1/2 left-[80%] w-[1px] bg-gray-300 h-[75%] transform -translate-y-1/2"></div>
        </div>
    </div>

    <!-- Stats Section -->
    <div class="grid grid-cols-2 gap-6 mt-6">
        <div class="bg-white p-4 rounded-lg shadow-md text-center">
            <p class="text-2xl font-bold">248</p>
            <p class="text-gray-500">Total Hours</p>
        </div>
        <div class="bg-white p-4 rounded-lg shadow-md text-center">
            <p class="text-2xl font-bold">12</p>
            <p class="text-gray-500">Organizations</p>
        </div>
    </div>

    <!-- Two column layour for endorsements & contributions and posts -->
    <div class="grid grid-cols-2 gap-6 mt-6 items-start">
        <!-- Left Column (Posts) -->
        <div class="flex flex-col space-y-6">
            <!-- Create a Post (Only for Own Profile) -->
            {% if is_own_profile %}
            <div class="bg-white p-4 rounded-lg shadow-md">
                <h2 class="text-lg font-bold mb-2">Create a Post</h2>
                <form id="status-post-form" 
                    hx-post="{% url 'volunteers_organizations:create_status_post' %}" 
                    hx-trigger="submit"
                    hx-target="#status-posts-container"
                    class="space-y-3">
                    <textarea name="content" class="w-full p-2 border rounded" placeholder="What's on your mind?" required></textarea>
                    <div class="flex justify-end">
                        <button type="submit" class="bg-blue-600 text-white px-4 py-1 text-sm rounded-md flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3" />
                            </svg>                              
                            <span class="font-bold">Post</span>
                        </button>
                    </div>
                </form>
            </div>
            {% endif %}

            <!-- Posts -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h1 class="text-lg text-center font-bold mb-2">Posts</h1>
                <div id="status-posts-container" class="w-full mb-6 space-y-4">
                    {% for post in status_posts %}
                    <div class="border-l-4 border-blue-500 pl-4">
                        <p class="text-gray-700 font-bold">
                            {% if post.author.user_type == "Volunteer" %}
                                {{ post.author.volunteer.first_name }} {{ post.author.volunteer.last_name }}
                            {% elif post.author.user_type == "Organization" %}
                                {{ post.author.organization.organization_name }}
                            {% else %}
                                Unknown User
                            {% endif %}
                        </p>
                        <p class="text-gray-500 text-sm italic">{{ post.author.user_type }}</p> 
                        <p class="text-gray-700">{{ post.content }}</p>
                        <p class="text-sm text-gray-500">{{ post.created_at|timesince }} ago</p>
                    </div>
                    {% empty %}
                    <p class="text-gray-500 text-center">No posts yet.</p>
                    {% endfor %}
                </div>
                <!-- Show "All posts loaded" only if there are posts -->
                {% if status_posts %}
                <div class="text-center mt-4 text-sm text-gray-500">All posts loaded</div>
                {% endif %}
            </div>
        </div>
        
        <!-- Right Column (Endorsements & Contributions) -->
        <div class="flex flex-col space-y-6">
            <!-- Create Endorsement (Only for Other Profiles) -->
            {% if not is_own_profile %}
                <!--If both the user and profile being viewed are organizations, dont give possibility to endorse-->
                {% if user.organization and user_profile.organization %}
                {% else %}
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h2 class="text-lg font-bold mb-2">Endorse This User</h2>
                        <form id="endorsement-form" 
                            hx-post="{% url 'volunteers_organizations:create_endorsement' user_profile.account.account_uuid %}" 
                            hx-trigger="submit"
                            hx-target="#endorsements-container"
                            class="space-y-3">
                            <textarea name="endorsement" class="w-full p-2 border rounded" placeholder="Write an endorsement..." required></textarea>
                            <div class="flex justify-end">
                                <button type="submit" class="bg-green-600 text-white px-4 py-1 text-sm rounded-md flex items-center justify-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5m.75-9 3-3 2.148 2.148A12.061 12.061 0 0 1 16.5 7.605" />
                                    </svg>                                      
                                    <span class="font-bold">Endorse</span>
                                </button>
                            </div>
                        </form>
                    </div>
                {% endif %}
            {% endif %}

            <!-- Endorsements -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h1 class="text-lg text-center font-bold mb-2">Endorsements</h1>
                <div id="endorsements-container" class="w-full mb-6 space-y-4">
                    {% for endorsement in endorsements %}
                    <div class="border-l-4 border-green-500 pl-4">
                        <p class="text-gray-700 font-bold">
                            {% if endorsement.giver.user_type == "Volunteer" %}
                                {{ endorsement.giver.volunteer.first_name }} {{ endorsement.giver.volunteer.last_name }}
                            {% elif endorsement.giver.user_type == "Organization" %}
                                {{ endorsement.giver.organization.organization_name }}
                            {% else %}
                                Unknown User
                            {% endif %}
                        </p>
                        <p class="text-gray-500 text-sm italic">{{ endorsement.giver.user_type }}</p> 
                        <p class="text-gray-700">"{{ endorsement.endorsement }}"</p>
                        <p class="text-sm text-gray-500">{{ endorsement.created_at|timesince }} ago</p>
                    </div>
                    {% empty %}
                    <p class="text-gray-500 text-center">No endorsements yet.</p>
                    {% endfor %}
                </div>
                <!-- Show "All endorsements loaded" only if there are endorsements -->
                {% if endorsements %}
                <div class="text-center mt-4 text-sm text-gray-500">All endorsements loaded</div>
                {% endif %}
            </div>

            <!-- Latest Contributions -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg text-center font-bold mb-2">Latest Contributions</h2>
                <div class="w-3/4 h-[1px] bg-gray-300 mx-auto mb-6"></div>
                <div class="space-y-4">
                    <div class="flex justify-between border-b pb-2">
                        <p class="text-gray-700">Contributed 4 hours at Animal Shelter</p>
                        <p class="text-gray-500 text-sm">Feb 15, 2025</p>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <p class="text-gray-700">Helped organize fundraising event</p>
                        <p class="text-gray-500 text-sm">Feb 10, 2025</p>
                    </div>
                    <div class="flex justify-between">
                        <p class="text-gray-700">Mentored new volunteers</p>
                        <p class="text-gray-500 text-sm">Feb 5, 2025</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--Preferences modal-->
    {% if show_preferences_modal %}
        {% include 'volunteers_organizations/partials/preferences_modal.html' %}
    {% endif %}
    <!-- Modal Container for responses for hx-target-->
    <div id="modal-container"></div>
{% endblock %}